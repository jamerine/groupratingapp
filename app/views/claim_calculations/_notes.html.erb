<div class="container notes-container">
  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-primary">
        <div class="panel-heading">Notes</div>
        <div class="panel-body">
          <table class="table table-striped note-datatable">
            <thead>
              <tr>
                <th width="15%" style="text-align: left;">Title</th>
                <th style="text-align: left;">Category</th>
                <th style="text-align: left;">Note</th>
                <th style="text-align: left;">User</th>
                <th style="text-align: center;" width="5%">Pinned</th>
                <th width="10%" style="text-align: right;"><%= link_to 'Add Note', new_claim_calculation_claim_note_path(@claim_calculation), class: 'btn btn-success btn-sm' %></th>
              </tr>
            </thead>
            <tbody>
              <% @claim_calculation.claim_notes.order(is_pinned: :desc, date: :desc, updated_at: :desc).each do |note| %>
                <tr>
                  <td width="15%" style="text-align: left;"><%= note.title %></td>
                  <td style="text-align: left;"><%= note.claim_note_category&.title %></td>
                  <td class="trix-content" style="text-align: left;">
                    <div style="max-height: 250px; overflow-y: scroll;"><%= note.body&.html_safe %></div>
                  </td>
                  <td style="text-align: left;"><%= note.user_email %></td>
                  <td width="5%" style="text-align: center" data-sort="<%= note.is_pinned? ? 1 : 0 %>">
                    <%= simple_form_for [@claim_calculation, note] do |f| %>
                      <%= f.input :is_pinned, as: :hidden, input_html: { value: !note.is_pinned? } %>
                      <%= button_tag class: "btn btn-transparent text-danger #{'pinned' if note.is_pinned?}", type: :submit, name: :save_pinned do %>
                        <i class="fa fa-lg fa-thumb-tack"></i>
                      <% end %>
                    <% end %>
                  </td>
                  <td width="10%" style="text-align: right;">
                    <%= link_to edit_claim_calculation_claim_note_path(@claim_calculation, note), class: 'btn btn-primary btn-sm' do %>
                      <i class="fa fa-edit"></i>
                    <% end %>

                    <% if current_user.admin? %>
                      <%= link_to claim_calculation_claim_note_path(@claim_calculation, note), method: :delete, class: 'btn btn-danger btn-sm', style: 'margin-right: 8px;', data: { confirm: 'Are you sure you want to delete this note?' } do %>
                        <i class="fa fa-trash"></i>
                      <% end %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .pinned {
    transform: rotate(-45deg)
  }
</style>